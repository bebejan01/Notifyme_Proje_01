<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>NotifyMe - GÃ¶rev Takip</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; margin: 30px; }
        .task { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .done { background-color: #d2ffd2; }

    body { font-family: Arial; margin: 30px; }

    .task {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
    }

    .done {
        background-color: #d2ffd2;
    }

    input, button {
        padding: 8px;
        margin: 5px 0;
        border-radius: 4px;
        border: 1px solid #aaa;
    }

    button, a.button-link {
        background-color: #007BFF;
        color: white;
        text-decoration: none;
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
    }

    a.button-link:hover {
        background-color: #0056b3;
    }

    .button-group {
        margin-top: 5px;
    }

    /* KartÄ± yumuÅŸakÃ§a kaydÄ±rÄ±p soluklaÅŸtÄ±ran animasyon */
    .card.fade-slide-out {
    transition: transform .32s ease, opacity .32s ease, box-shadow .32s ease;
    transform: translateY(-6px) scale(.98);
    opacity: 0;
    box-shadow: none;
}

    </style>
</head>
<body>
    

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div id="flash-message" style="background-color: #d4edda; padding: 10px; border-radius: 5px; border: 1px solid #c3e6cb; margin-bottom: 20px;">
      {% for message in messages %}
        <strong>{{ message }}</strong> âœ…
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form id="searchForm" method="get" action="/" class="d-flex gap-2 align-items-center mb-4">
  <input id="searchInput" type="text" name="search" class="form-control"
         placeholder="GÃ¶rev ara..." value="{{ request.args.get('search', '') }}">
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="hide_completed" value="true" id="hideCompleted"
           {% if hide_completed %}checked{% endif %}>
    <label class="form-check-label" for="hideCompleted">
      {{ 'TamamlanmÄ±ÅŸlarÄ± gÃ¶ster' if hide_completed else 'TamamlanmÄ±ÅŸlarÄ± gizle' }}
    </label>
  </div>
  <button type="submit" class="btn btn-primary">Ara</button>
</form>

<a id="toggleHideBtn" class="btn btn-outline-secondary mb-3"
   href="{{ url_for('index',
                    search=request.args.get('search',''),
                    category_filter=request.args.get('category_filter',''),
                    status_filter=request.args.get('status_filter',''),
                    hide_completed=('false' if hide_completed else 'true'),
                    page=request.args.get('page', 1)) }}">
  {{ 'TamamlananlarÄ± GÃ¶ster' if hide_completed else 'TamamlananlarÄ± Gizle' }}
</a>







<form method="get" action="/">
    <select name="category_filter">
        <option value="">TÃ¼m Kategoriler</option>
        <option value="Genel">Genel</option>
        <option value="Ders">Ders</option>
        <option value="SaÄŸlÄ±k">SaÄŸlÄ±k</option>
        <option value="Ä°ÅŸ">Ä°ÅŸ</option>
        <option value="KiÅŸisel">KiÅŸisel</option>
    </select>
    <select name="status_filter">
        <option value="">TÃ¼m Durumlar</option>
        <option value="pending">TamamlanmadÄ±</option>
        <option value="completed">TamamlandÄ±</option>
    </select>
    <button type="submit">Filtrele</button>
</form>

<form method="POST" action="/add" class="mb-4 p-3 border rounded bg-light">
  <div class="mb-3">
    <label for="title" class="form-label">BaÅŸlÄ±k</label>
    <input type="text" name="title" id="title" class="form-control" placeholder="GÃ¶rev baÅŸlÄ±ÄŸÄ±" required>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">AÃ§Ä±klama</label>
    <input type="text" name="description" id="description" class="form-control" placeholder="AÃ§Ä±klama">
  </div>

  <div class="mb-3">
    <label for="category" class="form-label">Kategori</label>
    <select name="category" id="category" class="form-select" required>
      <option value="Genel">Genel</option>
      <option value="Ders">Ders</option>
      <option value="Ä°ÅŸ">Ä°ÅŸ</option>
      <option value="KiÅŸisel">KiÅŸisel</option>
      <option value="SaÄŸlÄ±k">SaÄŸlÄ±k</option>
    </select>
  </div>

  <div class="mb-3">
    <label for="due_date" class="form-label">Teslim Tarihi</label>
    <input type="date" name="due_date" id="due_date" class="form-control" required>
  </div>

  <button type="submit" class="btn btn-success">GÃ¶rev Ekle</button>
</form>
<hr>



    {% if tasks %}
            <div class="container">
            <div class="row">
                {% for task in tasks %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card {% if task.completed %}bg-success text-white{% endif %}">
                            <div class="card-body">
                                <h5 class="card-title">
                                    {% if task.completed %}
                                        <s>{{ loop.index }}. {{ task.title }}</s>
                                    {% else %}
                                        {{ loop.index }}. {{ task.title }}
                                    {% endif %}
                                </h5>
                                <h6 class="card-subtitle mb-2 text-muted">{{ task.due_date }}</h6>
                                <p class="card-text">{{ task.description }}</p>
                                <p><em>Kategori:</em> {{ task.category }}</p>
                                <div class="btn-group" role="group">
  {% if not task.completed %}
    <a href="{{ url_for('complete',
                        index=loop.index0,
                        search=request.args.get('search',''),
                        category_filter=request.args.get('category_filter',''),
                        status_filter=request.args.get('status_filter',''),
                        hide_completed=('true' if hide_completed else 'false'),
                        page=request.args.get('page', 1)) }}"
       data-anim="out"
       class="btn btn-sm btn-success">âœ” Tamamla</a>
  {% endif %}

  <a href="{{ url_for('edit_task',
                      index=loop.index0,
                      search=request.args.get('search',''),
                      category_filter=request.args.get('category_filter',''),
                      status_filter=request.args.get('status_filter',''),
                      hide_completed=('true' if hide_completed else 'false'),
                      page=request.args.get('page', 1)) }}"
     class="btn btn-sm btn-primary">âœ DÃ¼zenle</a>

  <a href="{{ url_for('delete',
                      index=loop.index0,
                      search=request.args.get('search',''),
                      category_filter=request.args.get('category_filter',''),
                      status_filter=request.args.get('status_filter',''),
                      hide_completed=('true' if hide_completed else 'false'),
                      page=request.args.get('page', 1)) }}"
     data-anim="out"
     class="btn btn-sm btn-danger">ğŸ—‘ Sil</a>
</div>

                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        
        {% if total > 0 %}
  <div class="d-flex justify-content-between align-items-center my-3">
    <div class="text-muted small">
      GÃ¶sterilen: {{ start_index + 1 }}â€“{{ end_index }} / {{ total }}
    </div>

    <nav aria-label="Sayfalama">
      <ul class="pagination mb-0">
        <!-- Ã–nceki -->
        <li class="page-item {% if page <= 1 %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('index',
                                                search=request.args.get('search',''),
                                                category_filter=request.args.get('category_filter',''),
                                                status_filter=request.args.get('status_filter',''),
                                                hide_completed=('true' if hide_completed else 'false'),
                                                page=(page-1)) }}">Ã–nceki</a>
        </li>

        <!-- Sayfa NumaralarÄ± (kÃ¼Ã§Ã¼k projede hepsini gÃ¶stermek yeterli) -->
        {% for p in range(1, total_pages + 1) %}
          <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('index',
                                                  search=request.args.get('search',''),
                                                  category_filter=request.args.get('category_filter',''),
                                                  status_filter=request.args.get('status_filter',''),
                                                  hide_completed=('true' if hide_completed else 'false'),
                                                  page=p) }}">{{ p }}</a>
          </li>
        {% endfor %}

        <!-- Sonraki -->
        <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('index',
                                                search=request.args.get('search',''),
                                                category_filter=request.args.get('category_filter',''),
                                                status_filter=request.args.get('status_filter',''),
                                                hide_completed=('true' if hide_completed else 'false'),
                                                page=(page+1)) }}">Sonraki</a>
        </li>
      </ul>
    </nav>
  </div>
{% endif %}





    {% else %}
        <p>HenÃ¼z gÃ¶rev yok.</p>
    {% endif %}

<script>
    // Flash mesajÄ±nÄ± 3 saniyede gizle
    setTimeout(function() {
        const flash = document.getElementById('flash-message');
        if (flash) {
            flash.style.display = 'none';
        }
    }, 3000);
</script>

<script>
  // Tamamla/Sil'e tÄ±klandÄ±ÄŸÄ±nda Ã¶nce kart animasyon oynasÄ±n, sonra yÃ¶nlendirilsin
  document.addEventListener('click', function (e) {
    const link = e.target.closest('a[data-anim="out"]');
    if (!link) return;

    const card = link.closest('.card');
    if (!card) return;

    // Ã‡ift tÄ±klama/tekrar tÄ±klamayÄ± engelle
    e.preventDefault();
    link.classList.add('disabled');
    link.style.pointerEvents = 'none';

    // Animasyonu baÅŸlat
    card.classList.add('fade-slide-out');

    // Animasyon bitince (yaklaÅŸÄ±k 320ms) linke git
    setTimeout(function () {
      window.location.href = link.href;
    }, 330);
  });
</script>

<script>
(function() {
  // Storage anahtarlarÄ±
  const K_SEARCH = 'nm_search';
  const K_CAT    = 'nm_category';
  const K_STATUS = 'nm_status';
  const K_HIDE   = 'nm_hide';   // "true" | "false"

  // Elemanlar
  const searchForm   = document.getElementById('searchForm');
  const filterForm   = document.getElementById('filterForm');
  const searchInput  = document.getElementById('searchInput');
  const hideCheckbox = document.getElementById('hideCompleted');
  const categorySel  = document.getElementById('categorySelect');
  const statusSel    = document.getElementById('statusSelect');
  const toggleLink   = document.getElementById('toggleHideBtn');

  // URL parametrelerinden mevcut deÄŸerler
  const urlParams = new URLSearchParams(window.location.search);
  const urlHas = (key) => urlParams.has(key) && urlParams.get(key) !== '';

  // ----- Kaydet -----
  function savePrefs() {
    try {
      if (searchInput)  localStorage.setItem(K_SEARCH, searchInput.value || '');
      if (categorySel)  localStorage.setItem(K_CAT,    categorySel.value || '');
      if (statusSel)    localStorage.setItem(K_STATUS, statusSel.value || '');
      if (hideCheckbox) localStorage.setItem(K_HIDE,   hideCheckbox.checked ? 'true' : 'false');
    } catch(_) {}
  }

  // ----- YÃ¼kle (URL boÅŸsa doldur) -----
  function loadPrefsIfUrlEmpty() {
    try {
      if (searchInput && !urlHas('search')) {
        const v = localStorage.getItem(K_SEARCH);
        if (v !== null && !searchInput.value) searchInput.value = v;
      }
      if (categorySel && !urlHas('category_filter')) {
        const v = localStorage.getItem(K_CAT);
        if (v !== null && !categorySel.value) categorySel.value = v;
      }
      if (statusSel && !urlHas('status_filter')) {
        const v = localStorage.getItem(K_STATUS);
        if (v !== null && !statusSel.value) statusSel.value = v;
      }
      if (hideCheckbox && !urlHas('hide_completed')) {
        const v = localStorage.getItem(K_HIDE);
        if (v !== null) hideCheckbox.checked = (v === 'true');
      }
    } catch(_) {}
  }

  // ----- Toggle link href'ini gÃ¼ncelle -----
  function buildUrl(toggledHide = null) {
    const p = new URLSearchParams();

    const s = searchInput ? searchInput.value : '';
    const c = categorySel ? categorySel.value : '';
    const st= statusSel ? statusSel.value : '';

    if (s)  p.set('search', s);
    if (c)  p.set('category_filter', c);
    if (st) p.set('status_filter', st);

    const hideVal = (toggledHide !== null)
      ? toggledHide
      : (hideCheckbox && hideCheckbox.checked ? 'true' : 'false');
    p.set('hide_completed', hideVal);

    const q = p.toString();
    return '/' + (q ? ('?' + q) : '');
  }

  function refreshToggleHref() {
    if (!toggleLink) return;
    const nextHide = (hideCheckbox && hideCheckbox.checked) ? 'false' : 'true';
    toggleLink.setAttribute('href', buildUrl(nextHide));
  }

  // Eventlar
  if (searchForm) searchForm.addEventListener('submit', savePrefs);
  if (filterForm) filterForm.addEventListener('submit', savePrefs);

  [searchInput, categorySel, statusSel, hideCheckbox].forEach(el => {
    if (!el) return;
    el.addEventListener('input',  refreshToggleHref);
    el.addEventListener('change', refreshToggleHref);
  });

  // Ä°lk yÃ¼klemede
  loadPrefsIfUrlEmpty();
  refreshToggleHref();
})();
</script>


</body>
</html>
